# pip install selenium schedule
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.safari.options import Options as SafariOptions
import time
import schedule
from datetime import datetime

def check_for_eth_mentions():
    """Safarië¥¼ ì‚¬ìš©í•˜ì—¬ ì´ë”ë¦¬ì›€ ê´€ë ¨ í‚¤ì›Œë“œë¥¼ ëª¨ë‹ˆí„°ë§í•©ë‹ˆë‹¤."""
    username = 'VitalikButerin'
    now = datetime.now().strftime("%H:%M:%S")
    print(f"\n[{now}] === Vitalik íŠ¸ìœ— í™•ì¸ ===")
    
    driver = None
    try:
        # Safari ì˜µì…˜ ì„¤ì •
        safari_options = SafariOptions()
        
        # Safari ë“œë¼ì´ë²„ ì´ˆê¸°í™”
        driver = webdriver.Safari(options=safari_options)
        
        # íŠ¸ìœ„í„° í˜ì´ì§€ ë¡œë“œ
        url = f"https://twitter.com/{username}"
        print(f"ğŸŒ {url} ì ‘ì† ì‹œë„ ì¤‘...")
        driver.get(url)
        
        # í˜ì´ì§€ ë¡œë”© ëŒ€ê¸°
        time.sleep(5)
        
        # íŠ¸ìœ— ìš”ì†Œ ì°¾ê¸°
        tweets = driver.find_elements(By.XPATH, "//article[@data-testid='tweet']")
        
        if not tweets:
            print("âš ï¸ íŠ¸ìœ—ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
            return
            
        print(f"âœ… {len(tweets)} ê°œì˜ íŠ¸ìœ—ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤.")
        
        # ìµœëŒ€ 3ê°œ íŠ¸ìœ— í™•ì¸
        eth_found = False
        for i, tweet in enumerate(tweets[:3]):
            try:
                # íŠ¸ìœ— í…ìŠ¤íŠ¸ ì¶”ì¶œ
                tweet_text_elements = tweet.find_elements(By.XPATH, ".//div[@data-testid='tweetText']")
                if tweet_text_elements:
                    content = tweet_text_elements[0].text
                else:
                    continue
                
                # ë‚ ì§œ ì¶”ì¶œ
                date = "ë‚ ì§œ ì¶”ì¶œ ì‹¤íŒ¨"
                try:
                    time_elements = tweet.find_elements(By.XPATH, ".//time")
                    if time_elements:
                        date_attr = time_elements[0].get_attribute("datetime")
                        if date_attr:
                            date_obj = datetime.fromisoformat(date_attr.replace('Z', '+00:00'))
                            date = date_obj.strftime("%Y-%m-%d")
                except:
                    pass
                
                # íŠ¸ìœ— ë§í¬ ì¶”ì¶œ
                tweet_link = "ë§í¬ ì¶”ì¶œ ì‹¤íŒ¨"
                try:
                    link_elements = tweet.find_elements(By.XPATH, ".//a[contains(@href, '/status/')]")
                    if link_elements:
                        tweet_link = link_elements[0].get_attribute("href")
                except:
                    pass
                
                # ë‚´ìš© ì¶œë ¥
                print(f"- {date} | {content[:80]}{'...' if len(content) > 80 else ''}")
                
                # ETH í‚¤ì›Œë“œ í™•ì¸
                eth_keywords = ['ETH', 'ETHEREUM', 'ETHER']
                if any(keyword in content.upper() for keyword in eth_keywords):
                    print(f"ğŸš¨ ETH ì–¸ê¸‰ ê°ì§€ë¨: {tweet_link}")
                    eth_found = True
            except Exception as e:
                print(f"âš ï¸ íŠ¸ìœ— íŒŒì‹± ì¤‘ ì˜¤ë¥˜: {e}")
        
        if not eth_found:
            print("â›” ETH ì–¸ê¸‰ ì—†ìŒ")
            
    except Exception as e:
        print(f"âš ï¸ ì˜¤ë¥˜ ë°œìƒ: {e}")
    finally:
        if driver:
            driver.quit()

# ìµœì´ˆ ì‹¤í–‰
check_for_eth_mentions()

# ìŠ¤ì¼€ì¤„ ì„¤ì • (1ë¶„ë§ˆë‹¤)
schedule.every(60).seconds.do(check_for_eth_mentions)

# ë©”ì¸ ë£¨í”„
while True:
    schedule.run_pending()
    time.sleep(1)